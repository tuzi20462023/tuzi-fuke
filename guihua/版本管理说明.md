# 项目版本管理说明

> 创建日期：2025-12-04
> 用途：教学演示、版本管理

---

## 一、总体规划

| 功能模块 | 分支 | 版本策略 | 状态 |
|----------|------|----------|------|
| 探索系统 | `feature/explore` | 不分版本，直接含AI | ✅ 已完成 |
| 建筑系统 | `feature/building-system` | 打标签区分基础版/变体版 | 🚧 待开发 |

---

## 二、探索系统（feature/explore）

### 功能说明

探索功能 = 距离/面积/热量统计 + **AI物资描述**（一步到位）

### 功能列表

- [x] 开始/结束探索
- [x] 实时距离追踪（米/公里）
- [x] 网格面积统计（50m x 50m 网格）
- [x] 热量消耗计算
- [x] 探索时长计时
- [x] **本地物资掉落计算**（基于距离/面积/时长）
- [x] **AI 生成物资描述**（末世风格叙事）
- [x] 探索结果弹窗展示
- [x] 数据保存到 Supabase

### 核心文件

```
tuzi-fuke/
├── ExplorationManager.swift       # 探索管理器（状态、统计）
├── ExplorationView.swift          # 探索界面（按钮、卡片、结果弹窗）
├── ExplorationUploader.swift      # 数据上传（REST API）
└── AILootDescriptionGenerator.swift  # AI物资描述生成器 ⭐新增
```

### AI 物资系统说明

1. **本地计算物资**：根据探索数据（距离、面积、时长）计算物资掉落
2. **AI 叙事描述**：调用 Claude API 生成末世风格的探索故事
3. **备用方案**：无 API Key 时使用本地模板生成描述

### 示例输出

```
探索完成!

📖 探索发现：

"穿过一片废墟，我在倒塌的建筑里搜寻了30分钟。破碎的
窗户外传来不明的声响，我加快了脚步。还好，背包里多了
些补给。"

获得物资：
- 💧 矿泉水 x 8
- 🥫 罐头食品 x 5
- ⚙️ 废金属 x 12
- 👕 布料 x 6
```

---

## 三、建筑系统（feature/building-system）

### 版本规划

| 版本 | Git 标签 | 功能 | 适合场景 |
|------|----------|------|----------|
| 基础版 | `v1.0-building-basic` | 建筑建造/管理/删除 | 教学入门 |
| 变体版 | `v1.0-building-ai` | 基础版 + AI生成地点艺术图 | 展示AI集成 |

### 打标签时机

- 基础版开发完成后 → 打 `v1.0-building-basic`
- AI变体版开发完成后 → 打 `v1.0-building-ai`

---

## 四、如何切换版本（建筑系统）

### 命令行方式

```bash
# 查看基础版代码
git checkout v1.0-building-basic

# 查看AI变体版代码
git checkout v1.0-building-ai

# 回到开发分支继续开发
git checkout feature/building-system
```

### Xcode 方式

1. 菜单栏：`Source Control` → `Checkout...`
2. 在弹出窗口选择 `Tags` 标签页
3. 选择想要的版本标签
4. 点击 `Checkout`

### GitHub 网页方式

1. 打开仓库：https://github.com/tuzi20462023/tuzi-fuke
2. 点击分支下拉菜单
3. 切换到 `Tags` 标签页
4. 选择想要的版本

---

## 五、AI 配置说明

### 设置 Claude API Key

方式一：代码中设置
```swift
AILootDescriptionGenerator.setAPIKey("your-api-key")
```

方式二：环境变量
```bash
export ANTHROPIC_API_KEY="your-api-key"
```

### 无 API Key 时

系统会自动使用本地模板生成描述，功能正常运行，只是叙事不够个性化。

---

## 六、教学建议

### 探索系统演示要点

1. **Swift 基础**：状态管理、ObservableObject、单例模式
2. **SwiftUI**：视图组件、数据绑定、DisclosureGroup
3. **CoreLocation**：位置追踪、距离计算、网格统计
4. **网络请求**：REST API、Supabase 集成
5. **AI 集成**：Claude API 调用、async/await、错误处理

### 建筑系统演示要点（待开发）

1. 基础版：建筑 CRUD、进度条动画、地图标注
2. 变体版：AI 图像生成、旅行明信片概念

---

*文档创建于 2025-12-04*
